<style>
    :root {
        --mb-text-nomal: 16px;
    }

    .dv-content-quiz {
        padding: 10px;
    }

    .dv-content-quiz-box {
        background-color: white;
        padding: 10px;
        border-radius: 5px;
    }

    .dv-content-quiz-box.quizzes .quiz-title {
        font-size: 22px;
        font-weight: bold;
        color: #333;
    }

    .dv-content-quiz-box.quizzes .media-audio {
        margin-top: 15px;
    }

    .dv-content-quiz-box.quizzes .media-audio>span {
        font-size: 18px;
        font-weight: 500;
        color: #000000;
    }

    .dv-content-quiz-box.quizzes .media-audio>audio {
        width: 100%;
        margin-top: 5px;
    }

    .dv-content-quiz-box.quizzes .media-text {
        margin-top: 15px;
        border-bottom: 1px solid rgba(192, 192, 192, 0.5);
        padding-bottom: 10px;
    }

    .dv-content-quiz-box.quizzes .media-text>span {
        font-size: 18px;
        font-weight: 500;
        color: #000000;
    }

    .dv-content-quiz-box.quizzes .media-text>p {
        font-size: var(--mb-text-nomal);
        color: #333;
        margin-top: 5px;
    }

    .dv-content-quiz-box.quizzes .quizListQuestions {
        margin-top: 15px;
    }

    .dv-content-quiz-box.quizzes .quizListQuestions .question-box {
        /* border: 1px solid #ccc; */
        margin-top: 15px;
        padding: 10px;
        border-radius: 5px;
        background-color: rgba(231, 231, 231, 0.2);
    }

    .dv-content-quiz-box.quizzes .quizListQuestions .question-write>p,
    .dv-content-quiz-box.quizzes .quizListQuestions .question-choice>p {
        font-size: var(--mb-text-nomal);
        font-weight: 500;
        color: #000000;
    }

    .dv-content-quiz-box.quizzes .quizListQuestions .question-choice .answers-choice-group {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        margin-top: 15px;
        gap: 10px;
    }

    .dv-content-quiz-box.quizzes .quizListQuestions .question-choice .answers-choice-group>label {
        --border-color: transparent;
        flex: 1 1 45%;
        padding: 10px;
        border-radius: 5px;
        margin-top: 5px;
        cursor: pointer;
        display: flex;
        justify-content: start;
        align-items: center;
        gap: 5px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        background-color: white;
        border: 2px solid var(--border-color);
    }

    /* active question */
    .dv-content-quiz-box.quizzes .quizListQuestions:not(.showResult) .question-choice .answers-choice-group>label:hover {
        --border-color: blue;
    }

    .dv-content-quiz-box.quizzes .quizListQuestions .question-choice .answers-choice-group>label>input {
        display: none;
    }

    .dv-content-quiz-box.quizzes .quizListQuestions:not(.showResult) .question-choice .answers-choice-group>label:has(input:checked) {
        --border-color: blue;
    }

    .dv-content-quiz-box.quizzes .quizListQuestions .question-choice .answers-choice-group>label>span {
        font-size: var(--mb-text-nomal);
        color: #000000;
    }

    /* show Result */

    .dv-content-quiz-box.quizzes .quizListQuestions.showResult .question-choice .answers-choice-group>label {
        pointer-events: none;
    }

    .dv-content-quiz-box.quizzes .quizListQuestions.showResult .question-choice.isCorrectTrue .answers-choice-group>label:has(input:checked) {
        --border-color: green;
    }

    .dv-content-quiz-box.quizzes .quizListQuestions.showResult .question-choice.isCorrectFalse .answers-choice-group>label:has(input:checked) {
        --border-color: red;
    }

    .dv-content-quiz-box.quizzes .quizListQuestions .question-write>input {
        --border-color: transparent;
        width: 100%;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: var(--mb-text-nomal);
        color: #000000;
        margin-top: 5px;
        outline: none;
        background-color: white;
        border: 2px solid var(--border-color);
    }

    .dv-content-quiz-box.quizzes .quizListQuestions.showResult .question-write>input {
        pointer-events: none;
        border: 2px solid var(--border-color);
    }

    .dv-content-quiz-box.quizzes .quizListQuestions.showResult .question-write.isCorrectTrue>input {
        --border-color: green;
    }

    .dv-content-quiz-box.quizzes .quizListQuestions.showResult .question-write.isCorrectFalse>input {
        --border-color: red;
    }

    .dv-content-quiz-box.quizzes .submit-box {
        margin-top: 20px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .dv-content-quiz-box.quizzes .submit-box .btn.tryagain {
       background-color: green;
       border-color: green;
    }
    .dv-content-quiz-box.quizzes .submit-box .btn.tryagain:hover {
        background-color: rgb(0, 95, 0);
        border-color: green;
    }

    .dv-content-quiz-box.quizzes .submit-box .quize-score{
        font-size: 20px;
        font-weight: 500;
        color: #000000;
    }

    @media (max-width: 500px) {
        .dv-content-quiz-box.quizzes .quizListQuestions .question-choice .answers-choice-group>label {
            flex: 1 1 100%;
        }
    }
</style>








<div class="dv-content-quiz">



    <div class="dv-content-quiz-box quizzes">
        <form action="" id="formQuizzes">
            <div class="title">
                <h3 class="quiz-title"></h3>
            </div>

            <div class="quizmedia">
                <!-- <div class="media-audio">
                    <span>Nghe ddoan van tren va tra loi cau hoi</span>
                    <audio controls>
                        <source src="https://www.w3schools.com/html/horse.mp3" type="audio/mpeg">
                    </audio>
                </div> -->

                <!-- <div class="media-text">
                    <span>đọc đoạn văn dưới đây và trả lời câu hỏi</span>
                    <p>
                        My mother is a person I admire most. She devoted a lot of time and energy to the upbringing of my two brothers and 1. Despite working hard, she always made time to teach us many useful things which are necessary and important in our later lives. Moreover, she is a good role model for me to follow. She always tries to get on well with people who live next door and help everyone when they are in difficulties, so most of them respect and love her. I admire and look up to my mother because she not only brings me up well but also stands by me and gives some help if necessary. For example, when I encounter some difficulties, she will give me some precious advice to help me solve those problems. She has a major influence on me and 1 hope that I will inherit some of her traits.
                    </p>
                </div> -->
            </div>

            <div class="quizListQuestions">
                <!-- <div class="question-box question-choice">
                    <p class="question-title">1. What is the name of the animal?</p>
                    <div class="answers-choice-group">
                        <label class="answers-choice-label">
                            <input type="radio" name="question1" id="question1" value="1">
                            <span>hourse</span>
                        </label>
                        <label class="answers-choice-label">
                            <input type="radio" name="question1" id="question1" value="1">
                            <span>hourse</span>
                        </label>
                        <label class="answers-choice-label">
                            <input type="radio" name="question1" id="question1" value="1">
                            <span>hourse</span>
                        </label>
                        <label class="answers-choice-label">
                            <input type="radio" name="question1" id="question1" value="1">
                            <span>hourse</span>
                        </label>
                    </div>
                </div>
                <div class="question-box question-write">
                    <p class="question-title">2. What is the name of the animal?</p>
                    <input type="text" name="question2" id="question2" class="form-control" placeholder="Enter your answer">
                </div> -->
            </div>

            <!-- <div class="submit-box">
                <div class="quize-score"></div>
                <button type="button" class="btn btn-primary btn-submit-quiz">Submit</button>
            </div> -->
        </form>
    </div>
</div>


<script type="module">
    import { mbNotification, mbConfirm, mbLoading, mbFetch, mbPagination, mbFormData } from './public/js/allmodule.js';

    const Quizesdemo = {
        id: 1,
        idClasses: 1,
        totalQuestions: 3,
        title: "Quiz 1",
        mediaCMS: {
            title: "Media 1",
            type: 0,
            content: "https://www.youtube.com/watch?v=3JZ_D3ELwOQ"
        },
        questionsCMS: [
            {
                id: 1,
                questionName: "Question 1",
                typeAnswers: 0,
                answersCMS: [
                    {
                        id: 1,
                        answerName: "Answer 1",
                        isCorrect: true
                    },
                    {
                        id: 2,
                        answerName: "Answer 2",
                        isCorrect: false
                    },
                    {
                        id: 3,
                        answerName: "Answer 3",
                        isCorrect: false
                    },
                    {
                        id: 4,
                        answerName: "Answer 4",
                        isCorrect: false
                    }
                ]
            },
            {
                id: 2,
                questionName: "Question 2",
                typeAnswers: 0,
                answersCMS: [
                    {
                        id: 5,
                        answerName: "Answer 1",
                        isCorrect: true
                    },
                    {
                        id: 6,
                        answerName: "Answer 2",
                        isCorrect: false
                    },
                    {
                        id: 7,
                        answerName: "Answer 3",
                        isCorrect: false
                    },
                    {
                        id: 8,
                        answerName: "Answer 4",
                        isCorrect: false
                    }
                ]
            },
            {
                id: 3,
                questionName: "Question 3",
                typeAnswers: 1,
                answersCMS: {
                    id: 1,
                    answerName: "Answer 1",
                    isCorrect: true
                }
            }
        ]
    }

    const STTABC = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];

    const formQuizzes = document.getElementById('formQuizzes');
    const quizTitle = formQuizzes.querySelector('.quiz-title');
    const quizMedia = formQuizzes.querySelector('.quizmedia');
    const listQuestions = formQuizzes.querySelector('.quizListQuestions');
    const score = formQuizzes.querySelector('.quize-score');
    // const submitbox = formQuizzes.querySelector('.submit-box');

    let quizResult = {
        idQuizzesCMS: null,
        idClasses: null,
        score: 0,
        answers: []
    }

    renderQuizzes(Quizesdemo);

    function renderQuizzes(data) {
        quizResult = {
            idQuizzesCMS: null,
            idClasses: null,
            score: 0,
            answers: []
        }
        quizResult.idQuizzesCMS = data.id;
        quizResult.idClasses = data.idClasses;
        quizTitle.textContent = data.title;
        listQuestions.classList.remove('showResult');
        handlEmptyChildren(quizMedia);
        const mediaElement = hanldMediaComponent(data.mediaCMS)
        if (mediaElement) {
            quizMedia.appendChild(mediaElement);
        }
        const questions = data.questionsCMS;
        handlEmptyChildren(listQuestions);
        questions.forEach((question, index) => {
            quizResult.answers.push({
                idQuestionsCMS: question.id,
                idAnswersCMS: null,
                userAnswer: null,
                isCorrect: null,
            });

            let questionComponent = null;
            if (question.typeAnswers == 0) {
                questionComponent = quizChoiceComponent(question, index);
            } else if (question.typeAnswers == 1) {
                questionComponent = quizWriteComponent(question, index);
            }
            if (questionComponent) {
                listQuestions.appendChild(questionComponent);
            }
        });
        const submitBox = formQuizzes.querySelector('.submit-box');
        if (submitBox) {
            submitBox.remove();
        }
        formQuizzes.appendChild(submitCompoent());
        formQuizzes.addEventListener('submit', async function (e) {
            e.preventDefault();
            const confirmSubmit = await mbConfirm('Are you sure you want to submit?');
            if (!confirmSubmit) {
                return;
            }
            const totalQuestion = quizResult.answers.length;
            const maxScore = 10;
            const scoreEachQuestion = maxScore / totalQuestion;
            let score = 0;
            quizResult.answers.forEach(answer => {
                if (answer.isCorrect) {
                    score += scoreEachQuestion;
                }
            });
            score = Math.round(score * 10) / 10;
            quizResult.score = score;
            const boxScore = formQuizzes.querySelector('.quize-score');
            boxScore.textContent = `Your score: ${score}/${maxScore}`;
            renderQuizzesResult();
        });
    }

    function renderQuizzesResult() {
        listQuestions.classList.add('showResult');
        const questions = listQuestions.querySelectorAll('.question-box');
        const resultQuestions = quizResult.answers;
        questions.forEach((question) => {
            const indexQuestion = parseInt(question.getAttribute('data-indexQuestion'));
            const resultQuestion = resultQuestions[indexQuestion].isCorrect;
            if (resultQuestion === null) {
                return;
            }
            question.classList.add(resultQuestion ? 'isCorrectTrue' : 'isCorrectFalse');
            console.log(resultQuestion);
        });

        const submitBox = formQuizzes.querySelector('.submit-box');
        if (submitBox) {
            const btnold = submitBox.querySelector('.btn-submit-quiz');
            const newbtn = document.createElement('button');
            newbtn.classList.add('btn', 'btn-primary', 'btn-submit-quiz', 'tryagain');
            newbtn.textContent = 'Try Again';
            newbtn.type = 'button';
            newbtn.addEventListener('click', function () {
                renderQuizzes(Quizesdemo);
            });
            btnold.replaceWith(newbtn);
        }
    }


    function submitCompoent() {
        const divBox = document.createElement('div');
        divBox.classList.add('submit-box');
        divBox.innerHTML = `
        <div class="quize-score"></div>
        <button type="Submit" class="btn btn-primary btn-submit-quiz">Submit</button>
    `;
        return divBox;
    }

    function hanldMediaComponent(data) {
        if (!data) {
            return null;
        }
        if (data.type == 0) {
            return mediaAudioComponent(data);
        } else if (data.type == 1) {
            return mediaTextComponent(data);
        }
    }

    function mediaAudioComponent(data) {
        const divBox = document.createElement('div');
        divBox.classList.add('media-audio');
        divBox.innerHTML = `
                    <span>${data.title}</span>
                    <audio controls>
                        <source src="${data.content}" type="audio/mpeg">
                    </audio>
    `;
        return divBox;
    }

    function mediaTextComponent() {
        const divBox = document.createElement('div');
        divBox.classList.add('media-text');
        divBox.innerHTML = `
        <span>đọc đoạn văn dưới đây và trả lời câu hỏi</span>
        <p>
        My mother is a person I admire most. She devoted a lot of time and energy to the upbringing of my two brothers and 1. Despite working hard, she always made time to teach us many useful things which are necessary and important in our later lives. Moreover, she is a good role model for me to follow. She always tries to get on well with people who live next door and help everyone when they are in difficulties, so most of them respect and love her. I admire and look up to my mother because she not only brings me up well but also stands by me and gives some help if necessary. For example, when I encounter some difficulties, she will give me some precious advice to help me solve those problems. She has a major influence on me and 1 hope that I will inherit some of her traits.
        </p>
    `;
        return divBox;
    }

    function quizChoiceComponent(questions, indexQuestion) {
        console.log(questions);
        const divBox = document.createElement('div');
        divBox.classList.add('question-box', 'question-choice');
        divBox.setAttribute('data-indexQuestion', indexQuestion);
        divBox.innerHTML = `
                        <p class="question-title">${indexQuestion + 1}. ${questions.questionName}</p>
                    <div class="answers-choice-group"></div>
    `;

        const answers = questions.answersCMS;
        const answersGroup = divBox.querySelector('.answers-choice-group');
        answers.forEach((answer, index) => {
            const label = document.createElement('label');
            label.classList.add('answers-choice-label');
            label.innerHTML = `
            <input type="radio" name="question_${questions.id}" id="question_${questions.id}" value="${answer.id}">
            <span>${STTABC[index]}. ${answer.answerName}</span>
        `;
            // nếu có sự thay đổi radio thì làm gọi hàm handlanserChangeRadio
            label.querySelector('input').addEventListener('change', function (e) {
                // in ra value cuar radio
                // console.log(e.target.value);
                quizResult.answers[indexQuestion].idAnswersCMS = parseInt(e.target.value);
                quizResult.answers[indexQuestion].isCorrect = answer.isCorrect;
            });
            answersGroup.appendChild(label);
        });


        return divBox;
    }

    function quizWriteComponent(Question, indexQuestion) {
        const divBox = document.createElement('div');
        divBox.classList.add('question-box', 'question-write');
        divBox.setAttribute('data-indexQuestion', indexQuestion);
        divBox.innerHTML = `
        <p class="question-title">${indexQuestion + 1}. ${Question.questionName}</p>
    `;
        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = 'Enter your answer';
        input.addEventListener('input', function (e) {
            let truValue = Question.answersCMS.answerName.trim();
            let userValue = e.target.value.trim();
            if (userValue == '') {
                quizResult.answers[indexQuestion].userAnswer = null;
                quizResult.answers[indexQuestion].isCorrect = null;
                return;
            }
            quizResult.answers[indexQuestion].userAnswer = userValue;
            const resultBoolean = truValue.toLowerCase() == userValue.toLowerCase();
            quizResult.answers[indexQuestion].isCorrect = resultBoolean;
        });
        divBox.appendChild(input);
        return divBox;
    }

    function handlEmptyChildren(element) {
        while (element.firstChild) {
            element.removeChild(element.firstChild);
        }
    }



</script>